Clock tree tests
================

This repo contains the necessary files to generate clock tree XMLs of varying depths and fanouts, which can then be tested on the hardware. Currently the scripts primarily work with poets-ecosystem. The results output are the run times for 100 ticks.

This will discuss the basic purpose and/or usage of each script.

### clean

A simple script to remove the `objects` and `graphs` directories. It is used by `run.sh` to clean these directories at the start of every run.

`graphs` gathers XMLs that are generated by `create_clock_tree_instance.py` which can be quite large. They should be removed to avoid clogging the system up.

`objects` gathers the compiled binaries/other files for running on the hardware. These can also be quite large so are removed to avoid clogging the system again.

### clock_tree_single_handlers_graph_type.xml

This is the graph type for the clock tree to be tested. It contains the information for the message types, device types, and handlers for receiving messages and so on. It contains no information on any form of graph instance.

This is named `single_handlers` as it has been modified so there is a single device type, with a single input handler, and a single output handler. IMPolite is also being tested with clock trees, which requires a single device type with at most one input and one output handler. It makes sense to test the same graph type for every form of test we have.

### create_clock_tree_instance.py

A python script, this will take in some arguments, and using `clock_tree_single_handlers_graph_type.xml`, generate an XML containing both the above graph type, and the specified instance, based on a given depth and fanout. This generated XML can then be tested.

There are two possible sets of arguments:

1. Provide a CSV file. This will have two columns, depth and fanout, comma-separated. For each row in this file, the script will generate an XML in the `graphs` directory, and name it with the depth and fanout.

2. Provide two arguments: depth and fanout. This will generate a single XML and output it to `STDOUT`. This can then be pipelined into a file.

This script is utilized by `run.sh` to prepare XMLs.

### `run.sh`

The function of this script is to build XML(s) for given depth(s) and fanout(s), compile these using `pts-xmlc` from poets-ecosystem, and then run these on the hardware using `pts-serve`. This was designed to automate the testing process.

The command `--help` provides more information on the options for running this script, which will build XMLs for a given depth and fanout, a range of these, or from a CSV file. It also has options for compiling these XMLs, based on those for `pts-xmlc`.

The standard options are listed here:

* `--csv=c.csv` or `-c c.csv` - Every combination of depth and fanout in file `c.csv` will be built, compiled and run.

* `--depth=d` or `-d d` - Set the depth for this run to `d`. If a range of values is to be run (see `--range`), this sets the maximum depth.

* `--fanout=f` or `-f f` - Set the fanout for this run to `f`. If a range of values is to be run (see `--range`), this sets the maximum fanout.

* `--min-depth=d` - Set the minimum depth to be run to `d` for a range of tests (see `--range`).

* `--min-fanout=d` - Set the minimum fanout to be run to `f` for a range of tests (see `--range`).

* `--range` or `-r` - Runs from a minimum depth (default 1) and minimum fanout (default 1) to a given depth and fanout.

* `--results` - Provide a filepath for the CSV file the results will be output in. The default is `clock_tree_results.csv` in the main directory of this repo.

* `--xml-only` or `-x` - This will build only the XMLs for the given depth/fanout, range of depths/fanouts, or the CSV file of depths/fanouts.